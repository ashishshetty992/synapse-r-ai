Phase-3: AI/ML Neuron Layer + Planner Integration â€” Status Checklist

0) Ground Truth & North Star
	â€¢	âœ… Clear goal: AI-assisted runtime (intentâ†’schema, safe UQL, MySQL+Mongo, indexes/parity/policy).
	â€¢	âœ… Success criteria defined (Exit Criteria & Metrics list).

Action: none.

â¸»

1) Neurons Service (FastAPI) & Contracts
	â€¢	âœ… FastAPI app skeleton: /iem/build, /intent/encode, /synapse/match.
	â€¢	âœ… Pydantic models for request/response.
	â€¢	âœ… External uem.json (no hardcoding) â†’ produces iem.json.
	â€¢	âœ… Runs locally (no Docker).
	â€¢	ğŸŸ¨ Minimal error handling & input validation (happy-path only).
	â€¢	â›” Auth / rate limits / structured JSON logging.

Action: add robust validators (bad payloads, missing files), request-id logs, JSON logs.

â¸»

2) Neuron-1: Schema Understanding (IEM)
	â€¢	âœ… Field embeddings (char-ngrams) + role priors (id/timestamp/money/geo/category/text/qty).
	â€¢	âœ… Alias generation (underscored â†” spaced).
	â€¢	âœ… Deterministic iem.json (configurable dim).
	â€¢	ğŸŸ¨ Quality checks (ids cluster; amounts cluster) computed & surfaced â€” implicit only, not reported.
	â€¢	â›” IEM versioning & drift detection (compare IEM_t vs IEM_t-1).
	â€¢	â›” Entity-level embeddings.

Formula Lab
	â€¢	â›” F1 RoleBoostâ„¢ (role-aware vector: vâ€² = normalize(v + Î»áµ£Â·RÂ·r)) â†’ emit roleBoost per field.
	â€¢	â›” F2 AliasStabilityâ„¢ (drift guard; feeds S(p)).

Action: add /iem/verify to report clustering scores, roleBoost stats, and drift alerts.

â¸»

3) Neuron-2: Intent Encoder
	â€¢	âœ… Encoder v0.2 (IQL â†’ vector via char-ngrams bag).
	â€¢	âœ… /intent/encode returns {vec, vocab}.
	â€¢	â›” /intent/encode_nl (NL text â†’ vector) with synonyms injection.
	â€¢	â›” synonyms.json (e.g., â€œrevenueâ†’total_amountâ€, â€œcityâ†’shipping_cityâ€).

Formula Lab
	â€¢	â›” F6 SynoMixâ„¢ (BM25 alias score âŠ• cosine; boosts A(p) for NLQ).

Action: ship /intent/encode_nl + synonyms.json; log top alias hits.

â¸»

4) Neuron-3: Synapse Matching
	â€¢	âœ… Cosine ranking over IEM fields/entities.
	â€¢	âœ… Tunables: topKFields, topKEntities, roleAlpha.
	â€¢	ğŸŸ¨ Slot-filling rules exist conceptually; not exposed as API.
	â€¢	â›” Conflict resolver (multi â€œcityâ€ across entities).
	â€¢	â›” Join inference beyond single-hop (see Â§7).

Formula Lab
	â€¢	â›” F3 AlignPlusâ„¢ (coverage-aware A(p)): log {A_base, Coverage, OffSchemaRate, Aâº}.
	â€¢	â›” F4 PathScoreâ„¢ (scores multi-join paths).

Action: add /synapse/fill (slot fill + join hints) and /synapse/paths (path candidates + scores).

â¸»

5) Neuron-4: Auto-Question Generator (PoC)
	â€¢	ğŸŸ¨ Prototype spec (top_k / trend / compare) only.
	â€¢	â›” /generate â†’ 5 IQLs per schema.
	â€¢	â›” Validate with ops/validate-examples.js, write examples/aiql/.

Action: implement /generate, write files, run validator, capture coverage.

â¸»

6) Planner Integration (A/C/P/S/R with Beam)
	â€¢	âœ… Formula defined; default weights documented.
	â€¢	ğŸŸ¨ Trace shows planner params & slot candidates; missing A/C/P/S/R numbers.
	â€¢	ğŸŸ¨ A(p) partially via cosine (not AlignPlus components).
	â€¢	ğŸŸ¨ C(p) hinted by adapter errors (unindexed ranges) but not scored.
	â€¢	ğŸŸ¨ P(p) simple penalty concept; not consistently applied.
	â€¢	â›” S(p) (alias brittleness) not computed.
	â€¢	â›” R(p) (parity/RBAC) not computed.
	â€¢	â›” Boltzmann exploration (Ï„) in beam selection.

Formula Lab
	â€¢	â›” F3 AlignPlusâ„¢ â†’ A(p)
	â€¢	â›” F8 CostPlusâ„¢ â†’ C(p)
	â€¢	â›” F5 GroupInfoâ„¢ â†’ P(p)
	â€¢	â›” F2 AliasStabilityâ„¢ â†’ S(p)
	â€¢	â›” F7 ParityTauâ„¢ â†’ R(p)

Action: implement neuronScore(plan) and log {A,C,P,S,R,weights,final,Ï„}; wire adapter cost hints.

â¸»

7) Schema Graph & Multi-Join Reasoning
	â€¢	ğŸŸ¨ Single-hop join working (sales_order â†” customer) â€” proven.
	â€¢	â›” Build graph.json (entities + edges: FK=1.0, heuristics<1.0).
	â€¢	â›” find_paths(source,target,max_depth=3) + PathScore ranking.
	â€¢	â›” Join path disambiguation using Aâº/C/S.

Formula Lab
	â€¢	â›” F4 PathScoreâ„¢ (semantics + index + fanout + hop cost).

Action: ship graph builder, path finder, /synapse/paths; add 2-hop cases (ordersâ†’order_itemâ†’product).

â¸»

8) Multi-GroupBy & Complex Query Shapes
	â€¢	âœ… Single & dual groupBy (segmentÃ—country; city over periods).
	â€¢	ğŸŸ¨ Triple groupBy tests (MySQL GROUP BY list, Mongo composite _id) â€” not in suite.
	â€¢	ğŸŸ¨ Compare periods Ã— extra dims (periodÃ—segmentÃ—country) â€” missing tests.
	â€¢	â›” Window functions (moving avg, YoY) â€” defer to Phase-4.
	â€¢	ğŸŸ¨ Nested AND/OR across joins â€” partial coverage.

Formula Lab
	â€¢	â›” F5 GroupInfoâ„¢ (parsimony vs informativeness) to score group sets.

Action: add 3Ã— groupBy examples; AND/OR precedence cases on both engines; log P(p)/InfoGainÌ‚.

â¸»

9) Integration with Phase-2 Runtime
	â€¢	âœ… E2E proven: orders.* (neuron) â†’ sales_order.* UQL/SQL; MySQL & Mongo OK.
	â€¢	âœ… x-intent-vec path works for compile/query.
	â€¢	ğŸŸ¨ Feature flag USE_NEURONS=1 (toggle planner) â€” not plumbed.
	â€¢	ğŸŸ¨ Trace: add A/C/P/S/R everywhere.
	â€¢	â›” Fallback policy (low neuronScore â†’ rule planner + log).

Action: add flag + fallback; propagate Formula Lab values to trace.

â¸»

10) Parity, Index Safety & Policy
	â€¢	âœ… Parity endpoint works; minor ordering diffs acceptable.
	â€¢	âœ… Index guard requireIndexedFilters=true active.
	â€¢	ğŸŸ¨ Feed index/complexity hints into CostPlusâ„¢.
	â€¢	â›” RBAC allowlist + penalties into R(p).

Formula Lab
	â€¢	â›” F7 ParityTauâ„¢ (Kendall Ï„ from sampled parity) â†’ R(p).
	â€¢	â›” F8 CostPlusâ„¢ (unindexed_range, join_depth, like_contains, non_sargable, est_rows).

Action: emit hints from adapters; compute Ï„_K from parity sample; wire to C(p)/R(p).

â¸»

11) Tests & Tooling
	â€¢	âœ… Phase-2 exerciser extended; both engines + extras run.
	â€¢	âœ… Examples validate against schema.
	â€¢	â›” run-phase3-tests.sh invoking neurons: /iem/build, /iem/verify, /intent/encode(_nl), /synapse/match, /synapse/paths, /synapse/fill, /generate.
	â€¢	â›” Assertions: compiled UQL runs; traces contain {A,C,P,S,R,Ï„}; multi-join & 3Ã— groupBy cases; parity Ï„_K present.

Action: add phase-3 runner + summary.

â¸»

12) Documentation & Operability
	â€¢	ğŸŸ¨ Phase-3 Test Report template (like Phase-1/2).
	â€¢	â›” README-neurons.md (how to wire neurons; flags, headers, traces).
	â€¢	â›” Whitepaper appendix: A/C/P/S/R examples & weight sensitivity.

Action: draft report + README + appendix.

â¸»

Whatâ€™s DONE vs IN-PROGRESS vs NOT-TOUCHED

âœ… Done (yesterday snapshot)
	â€¢	Neurons service endpoints up.
	â€¢	Pydantic models; external UEM â†’ IEM.
	â€¢	IEM bootstrap (embeddings, roles, aliases; deterministic).
	â€¢	Intent encoder v0.2 (/intent/encode).
	â€¢	Synapse cosine matcher + tunables.
	â€¢	Runtime E2E with x-intent-vec (orders.* â†’ sales_order.*) on MySQL & Mongo.
	â€¢	Parity endpoint & index guard active.

ğŸŸ¨ In Progress
	â€¢	Validation & error handling; JSON logs.
	â€¢	Quality checks for IEM; surface via /iem/verify.
	â€¢	Slot-filling API (/synapse/fill); conflict resolver design.
	â€¢	Planner partial scoring (A/C/P skeletons), traces missing numbers.
	â€¢	Triple groupBy & complex AND/OR tests.
	â€¢	USE_NEURONS feature flag; richer traces.
	â€¢	Phase-3 test runner; basic report template.

â›” Not Yet Touched (Formula Lab & extras)
	â€¢	F1 RoleBoostâ„¢, F2 AliasStabilityâ„¢.
	â€¢	F3 AlignPlusâ„¢ (coverage-aware A).
	â€¢	F4 PathScoreâ„¢ (multi-join chooser) + /synapse/paths.
	â€¢	F5 GroupInfoâ„¢ (parsimony).
	â€¢	F6 SynoMixâ„¢ (synonym confidence) + /intent/encode_nl + synonyms.json.
	â€¢	F7 ParityTauâ„¢ â†’ R(p).
	â€¢	F8 CostPlusâ„¢ â†’ C(p).
	â€¢	Auto-question /generate + validation harness.
	â€¢	RBAC stub & penalty in R(p).
	â€¢	Fallback policy to rule-planner.

â¸»

Immediate Next Actions (surgical)
	1.	Planner scoring & trace: implement neuronScore() with F3/F5/F8; log {A,C,P,S,R,final,Ï„}.
	2.	Graph & paths: build graph.json, add find_paths() + F4 PathScoreâ„¢; ship /synapse/paths.
	3.	/synapse/fill: slot fill + join hints; add 3Ã— groupBy examples.
	4.	Intent NL: /intent/encode_nl + F6 SynoMixâ„¢; load synonyms.json.
	5.	Costs/Parity: adapter hints â†’ F8 CostPlusâ„¢; parity sample â†’ F7 ParityTauâ„¢.
	6.	Phase-3 runner: run-phase3-tests.sh invoking all neuron endpoints; collect traces & parity Ï„_K.